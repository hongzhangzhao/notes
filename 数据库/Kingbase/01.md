

## kingbase

  

不支持“一次登录访问所有数据库”，每个连接会话只能访问一个数据库。

  

maven添加kingbase依赖:


```xml

<dependency>

    <groupId>com.kingbase8</groupId>

    <artifactId>kingbase8</artifactId>

    <version>8.6.0</version>

    <scope>system</scope>

    <systemPath>${project.basedir}/src/main/resources/libs/kingbase8-8.6.0.jar</systemPath>

</dependency>

```

  

jdbc连接: jdbc:kingbase8://host:port/database

  

```java
import java.sql.*;

  

public class Test {

    public static final String url = "jdbc:kingbase8://192.168.3.53:53306/dsp";  //MOMO改为自己数据库的名字

    public static final String name = "com.Kingbase8.Driver";

    public static final String user = "system";

    public static final String password = "123456";  //这里的用户名和密码大家应该都一样，不一样的设置为自己的就好

  

    public Connection conn = null;

    public PreparedStatement pst = null;

  

    public void Getcon() {

        try {

//            Class.forName(name);//指南中的这个方法运行不成功  , 原因时kingbase8写错了，k不能大写

            DriverManager.registerDriver(new com.kingbase8.Driver());

            conn = DriverManager.getConnection(url, user, password);//获取连接

            System.out.print("yes");

        } catch (Exception e) {

            e.printStackTrace();

        }

    }

  

    public void close() {

        try {

            this.conn.close();

        } catch (SQLException e) {

            e.printStackTrace();

        }

    }

  

    public static void main(String[] args) throws java.sql.SQLException {

        Test t = new Test();

        t.Getcon();

        t.pst = t.conn.prepareStatement("select * from public.data_type");//准备执行语句

        ResultSet ret = t.pst.executeQuery();

        while (ret.next()) {

            String c_idcard = ret.getString(1);

            String c_accont = ret.getString(2);

            String c_key = ret.getString(3);

            String c_name = ret.getString(4);

            System.out.println(c_idcard + "\t" + c_accont + "\t" + c_key + "\t" + c_name );

        }

        t.close();

    }

}

  

-------------

  
  

import java.sql.*;

  
  

public class Test {

    public static String url = "jdbc:kingbase8://192.168.3.53:53306/dsp";

    public static String name = "com.kingbase8.Driver";

    public static String user = "system";

    public static String passsword = "123456";

    public PreparedStatement pst = null;

  

    public static void main(String[] args) {

        try {

            Class.forName(name);

            Connection conn = DriverManager.getConnection(url,user,passsword);

            String sql = "select * from public.data_type";

            PreparedStatement ps = conn.prepareStatement(sql);

            ResultSet result = ps.executeQuery();

            while(result.next()){

                System.out.println(result.getInt(1));

            }

            System.out.println("yes");

            if(conn!=null){

                conn.close();

            }

        }catch (Exception e){

            e.printStackTrace();

        }

    }

}

  

----

  
  
  

select schemaname,tablename from pg_tables p where p.tablename not like ('pg%') and p.tablename not like ('sql%') and schemaname != 'sys' and schemaname != 'SYS_HM' and schemaname != 'pg_catalog' and schemaname != 'sysmac' and schemaname != 'information_schema'

  
  

select schemaname,tablename from pg_tables p where schemaname != 'sys' and schemaname != 'SYS_HM' and schemaname != 'pg_catalog' and schemaname != 'sysmac' and schemaname != 'information_schema'


// 需要排除的库

sys

SYS_HM

public

pg_catalog

sysmac

  
  

SELECT

    n.nspname AS schema_name,

    c.relname AS table_name,

    a.attname AS column_name,

    pg_catalog.format_type(a.atttypid, a.atttypmod) AS column_type,

    d.description AS column_comment -- 字段备注

FROM

    pg_catalog.pg_class c

JOIN

    pg_catalog.pg_namespace n ON n.oid = c.relnamespace

JOIN

    pg_catalog.pg_attribute a ON a.attrelid = c.oid

LEFT JOIN -- 使用 LEFT JOIN 以便即使没有备注也能显示字段信息

    pg_catalog.pg_description d ON d.objoid = a.attrelid AND d.objsubid = a.attnum

WHERE

    c.relkind = 'r'  -- 'r' 表示普通表 (regular table)

    AND n.nspname NOT IN ('pg_catalog', 'information_schema', 'pg_toast') -- 排除系统自带模式

    AND a.attnum > 0 -- 排除系统字段 (如 ctid, xmin 等)

    AND NOT a.attisdropped -- 排除已删除的字段

ORDER BY

    schema_name,

    table_name,

    a.attnum;

  
  

```

  

创建数据库

  

首先，你需要连接到 Kingbase 数据库。通常，你会连接到默认的 kingbase 数据库或 system 用户下。

```sql

ksql -U system -d kingbase

  

CREATE DATABASE mydb01

OWNER user1

TEMPLATE template0

ENCODING 'UTF8'

CONNECTION LIMIT 10;

  
  

CREATE TABLE `dsp_data_asset_metadata_kingbase` (

  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,

  `asset_id` int(11) NOT NULL COMMENT '资产id',

  `asset_name` varchar(100) NOT NULL COMMENT '资产名称',

  `asset_database_name` varchar(100) NOT NULL COMMENT '库名',

  `asset_table_name` varchar(100) NOT NULL COMMENT '表名',

  `asset_column_name` varchar(100) DEFAULT NULL COMMENT '列名',

  `asset_column_type` varchar(100) DEFAULT NULL COMMENT 'int/string/time',

  `sensitive_define` int(11) DEFAULT '0' COMMENT '是否敏感：0/1 未知/正常，2 敏感',

  `level_id` int(11) DEFAULT NULL COMMENT '级别id',

  `data_level_name` varchar(64) DEFAULT NULL COMMENT '级别名称',

  `category_id` int(11) DEFAULT NULL COMMENT '类别id',

  `category3_name` varchar(64) DEFAULT NULL,

  `data_type` varchar(64) DEFAULT NULL COMMENT '数据类型ID',

  `data_type_name` varchar(64) DEFAULT NULL COMMENT '数据类型名称',

  `asset_schema` varchar(100) NOT NULL COMMENT 'schema',

  `instance_name` varchar(100) NOT NULL COMMENT '实例名称',

  `column_comment` varchar(1000) DEFAULT NULL COMMENT '字段注释',

  `original_data` varchar(5000) DEFAULT NULL COMMENT '原始数据内容',

  `column_data_size` varchar(64) DEFAULT NULL COMMENT '字段数据大小',

  `column_data_count` int(11) DEFAULT NULL COMMENT '字段数据量',

  `is_data_add` int(11) DEFAULT '0' COMMENT '字段是否为新增',

  PRIMARY KEY (`id`),

  UNIQUE KEY `asset_id` (`asset_id`,`asset_database_name`,`asset_schema`,`asset_table_name`,`asset_column_name`,`instance_name`)

) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

  
  
  

CREATE TABLE `dsp_data_asset_metadata_doris` (

  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,

  `asset_id` int(11) NOT NULL COMMENT '资产id',

  `asset_name` varchar(100) NOT NULL COMMENT '资产名称',

  `asset_database_name` varchar(100) NOT NULL COMMENT '库名',

  `asset_table_name` varchar(100) NOT NULL COMMENT '表名',

  `asset_column_name` varchar(100) DEFAULT NULL COMMENT '列名',

  `asset_column_type` varchar(100) DEFAULT NULL COMMENT 'int/string/time',

  `sensitive_define` int(11) DEFAULT '0' COMMENT '是否敏感：0/1 未知/正常，2 敏感',

  `level_id` int(11) DEFAULT NULL COMMENT '级别id',

  `data_level_name` varchar(64) DEFAULT NULL COMMENT '级别名称',

  `category_id` int(11) DEFAULT NULL COMMENT '类别id',

  `category3_name` varchar(64) DEFAULT NULL,

  `data_type` varchar(64) DEFAULT NULL COMMENT '数据类型ID',

  `data_type_name` varchar(64) DEFAULT NULL COMMENT '数据类型名称',

  `asset_schema` varchar(100) NOT NULL COMMENT 'schema',

  `instance_name` varchar(100) NOT NULL COMMENT '实例名称',

  `column_comment` varchar(1000) DEFAULT NULL COMMENT '字段注释',

  `original_data` varchar(5000) DEFAULT NULL COMMENT '原始数据内容',

  `column_data_size` varchar(64) DEFAULT NULL COMMENT '字段数据大小',

  `column_data_count` int(11) DEFAULT NULL COMMENT '字段数据量',

  `is_data_add` int(11) DEFAULT '0' COMMENT '字段是否为新增',

  PRIMARY KEY (`id`),

  UNIQUE KEY `asset_id` (`asset_id`,`asset_database_name`,`asset_schema`,`asset_table_name`,`asset_column_name`,`instance_name`)

) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

  
  

字段为空数量最少的优先：

SELECT *

FROM public.data_type

ORDER BY

    (CASE WHEN type_name IS NOT NULL THEN 1 ELSE 0 END) +

    (CASE WHEN match_type IS NOT NULL THEN 1 ELSE 0 END) +

    (CASE WHEN data_structure IS NOT NULL THEN 1 ELSE 0 END) +

    (CASE WHEN dictionary_configuration IS NOT NULL THEN 1 ELSE 0 END) +

    (CASE WHEN fuzzy_matching IS NOT NULL THEN 1 ELSE 0 END) +

    (CASE WHEN source_type IS NOT NULL THEN 1 ELSE 0 END) +

    (CASE WHEN tag IS NOT NULL THEN 1 ELSE 0 END)

    DESC

LIMIT 1;

  
  

字段不为空的数据条数

SELECT

    COUNT(type_name) AS type_name,

    COUNT(match_type) AS match_type,

    COUNT(data_structure) AS data_structure,

    COUNT(dictionary_configuration) AS dictionary_configuration,

    COUNT(fuzzy_matching) AS fuzzy_matching,

    COUNT(source_type) AS source_type,

    COUNT(tag) AS tag

FROM

    public.data_type;

  
  

表的存储大小

  

SELECT

    pg_size_pretty(pg_relation_size('public.data_type')) AS TableDataSize,

    pg_size_pretty(pg_total_relation_size('public.data_type')) AS TotalTableSize;

  
  

返回的是字节数

SELECT pg_relation_size('public.data_type') AS tableDataSize;

```

  
## dbeaver连接配置

- 驱动名称： kingbase
- 类名： com.kingbase8.Driver
- URL模板： jdbc:kingbase8://{host}[:{port}]/[{database}]
- 默认用户： SYSTEM
- 默认数据库： test
- 默认端口： 54321


## kingbase创建数据库

注意：下面多行的语句是一条sql

```sql
CREATE DATABASE mydb02
WITH
OWNER = system
ENCODING = 'UTF8'
LC_COLLATE = 'zh_CN.UTF-8'
TEMPLATE = template0;
```


- 选择一个库

类似mysql的USE操作

```sql
SET search_path TO 库名;
```