制作镜像
===

## 制作一个常用工具镜像

制作一个基于ubuntu的基础工具镜像 主要安装了一些常用小工具
构建镜像 docker build -t ubuntu:24.04-tool .
启动镜像 docker run --rm -it ubuntu:24.04-tool bash

创建Dockerfile文件 内容如下
```sh
FROM ubuntu:24.04

RUN apt update

# 安装 tzdata（带非交互模式）
ENV DEBIAN_FRONTEND=noninteractive
RUN apt install tzdata && ln -fs /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

# 安装 locale 工具 + 生成 UTF-8 环境
RUN apt install -y locales && locale-gen en_US.UTF-8

# 声明环境变量
ENV LANG=en_US.UTF-8 \
    LANGUAGE=en_US:en \
    LC_ALL=en_US.UTF-8

# 安装常用工具
RUN apt install -y iputils-ping net-tools curl wget telnet dnsutils vim unzip
```

- 欧拉版

构建镜像 docker build -t euler:22.03-tool .
启动镜像 docker run --rm -it euler:22.03-tool bash

mariadb-devel是为了安装libmysqlclient库 但是没用 依然需要libmysqlclient.so.21

```sh
FROM openeuler/openeuler:22.03-lts-sp1

# 安装 tzdata（带非交互模式）
ENV DEBIAN_FRONTEND=noninteractive \
  LANG=C.UTF-8 \
  LC_ALL=C.UTF-8

RUN dnf install -y tzdata \
 vim net-tools telnet unzip curl mariadb-devel \
 && ln -snf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
 && dnf clean all

```


## 上传文件到镜像中

构建镜像 docker build -t ubuntu:24.04-python .
启动镜像 docker run --rm -it ubuntu:24.04-python bash

ADD命令可以将文件添加到镜像中，随后自动解压
```
FROM ubuntu:24.04-tool

ADD logad39.tar.gz /opt/python39

COPY libmysqlclient.so.21.2.35 /usr/lib64/
RUN ln -s libmysqlclient.so.21.2.35 /usr/lib64/libmysqlclient.so.21 && ldconfig
```

- 欧拉版

构建镜像 docker build -t euler:22.03-python .
启动镜像 docker run --rm -it euler:22.03-python bash
```sh
FROM euler:22.03-tool

ADD logad39.tar.gz /opt/python39

COPY libmysqlclient.so.21.2.35 /usr/lib64/
# RUN ln -s /usr/lib64/libmysqlclient.so.21.2.35 /usr/lib64/libmysqlclient.so.21 && ldconfig
RUN ldconfig
```


## 启动容器 执行命令

### Dockerfile中定义命令执行

执行命令有2种方式 他俩可以配合使用
- CMD
- ENTRYPOINT

CMD 是「默认动作」，可被 docker run 后面的参数覆盖；ENTRYPOINT 是「固定动作」，除非显式加 --entrypoint，否则不会被覆盖，通常用来定义主进程。

### docker-compose.yaml中定义命令执行

- command
  - 等同于 docker run 镜像 命令 参数，会覆盖镜像中定义的 CMD，但不会覆盖 ENTRYPOINT。适合“程序固定，参数可变”的场景。
- entrypoint
  - 等同于 docker run --entrypoint 可执行文件，会完全替换镜像中定义的 ENTRYPOINT（并把原 CMD 清空）。
  - 适合“连程序本身都要换”或“需要在主程序前做预处理”的场景。

## 启动一个调试容器

docker-compose run --rm <service_name> bash

- run：专门为一次性/调试任务启动一个新容器，不会用已经在 docker-compose up 里跑起来的那个实例。
- --rm：运行完自动删掉这个临时容器，保持环境干净。
- <service_name>：就是 compose 文件里写的那个服务名。
- bash：覆盖原镜像的启动命令，直接开 bash。如果镜像里是 sh 而不是 bash，把最后的 bash 换成 sh 即可。

docker-compose exec <service> bash  这种方式进入一个已经启动的容器

## 查看容器日志

- 查看全部日志 docker-compose logs -f
- 查看某个服务的日志 docker-compose logs -f <service_name>
- 查看尾部 docker-compose logs -f --tail=200 <service_name>

## 安装依赖库

- mysql连接数据库时抛错： django.core.exceptions.ImproperlyConfigured: Error loading MySQLdb module: libmysqlclient.so.21: cannot open shared object file: No such file or directory
- 下载这个库（libmysqlclient.so.21） apt install -y libmysqlclient-dev

构建镜像 docker build -t dsp/logauditapi:5.0.1 .
启动镜像 docker run --rm -it dsp/logauditapi:5.0.1 bash
```sh
FROM ubuntu:24.04-python

RUN apt install -y libmysqlclient-dev libstdc++6
```

## Flume

